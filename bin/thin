#!/usr/bin/env ruby
# Script to launch a Thin server for a Rails application.
# Run <tt>thin -h</tt> do get help.

require File.dirname(__FILE__) + '/../lib/thin'

Thin::Commander.new(ARGV) do |command|
  command.include_options :port, :address, :environment, :daemonize, :log_file, :pid_file
  
  command.before do
    Dir.chdir command.options.cwd if command.options.cwd
  end
  
  command.on :start do
    server = Thin::Server.new(command.options.address, command.options.port,
                              # Let Rails handle his thing and ignore files
                              Thin::RailsHandler.new('.', command.options.environment),
                              # Serve static files
                              Thin::DirHandler.new('public')
                             )
    server.logger = Logger.new(command.options.log_file) if command.options.log_file

    if command.options.daemonize
      server.pid_file = command.options.pid_file
      server.daemonize
    else
      server.start
    end
  end

  command.on :stop do
    command.error "PID file required to stop server" unless command.options.pid_file
    Thin::Server.kill(command.options.pid_file)
  end
end
